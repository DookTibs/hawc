{% extends 'portal.html' %}

{% load crispy_forms_tags %}

{% block title %}
  {{assessment}} | {{study}} | {{crud}} {% if crud == "Create" %}Experiment{% else %}{{object}}{% endif %} | HAWC
{% endblock title %}

{% block breadcrumbs %}
  <li><a href="{% url 'assessment:detail' pk=assessment.pk %}">{{ assessment }}</a><span class="divider">/</span></li>
  {% if crud == "Update" %}
    <li><a href="{% url 'study:detail' object.study.pk %}">{{object.study}}</a><span class="divider">/</span></li>
    <li><a href="{% url 'animal:experiment_detail' object.pk %}">{{object}}</a><span class="divider">/</span></li>
    <li class="active">{{ crud }} </li>
  {% else %}
    <li><a href="{% url 'study:detail' study.pk %}">{{study}}</a><span class="divider">/</span></li>
    <li class="active"> {{ crud }} Experiment <span class="divider">/</span></li>
  {% endif %}
{% endblock %}

{% block content %}

  {% crispy form %}

{% endblock %}

{% block extrajs %}
  <script type="text/javascript">
    $(document).ready(function(){
      $('#id_description').quillify();

      var pa = $('#id_purity_available'),
          addBlankOption = function(setAsBlank){
            var sel = $('#id_purity_qualifier'),
                blank = sel.find('option[value=""]');
            if(setAsBlank){
              if(blank.length===0) blank = $('<option value=""></option>').appendTo(sel);
              blank.prop('selected', true);
            } else {
              blank.remove();
            }
          },
          showPurity = function(){
            if (pa.prop('checked')){
              $('#div_id_purity').show();
              $('#div_id_purity_qualifier').show();
              addBlankOption(false);
            } else {
              $('#div_id_purity_qualifier').hide();
              $('#div_id_purity').hide();
              $('#id_purity').val("");
              addBlankOption(true);
            }
          };
      pa.on('change', showPurity).trigger('change');

      var type = $('#id_type'),
          litEff = $('#id_litter_effects'),
          litEffNotes = $('#id_litter_effect_notes'),
          litterDiv = litEff.parent().parent().parent(),
          showLitterEffects = function(){
            if (["Rp", "Dv", "Ot"].indexOf(type.val())>=0){
              litterDiv.show();
            } else {
              litterDiv.hide();
              litEff.val("NA");
              litEffNotes.val("");
            }
          };
      type.on('change', showLitterEffects).trigger('change');

    });
  </script>
{% endblock extrajs %}
